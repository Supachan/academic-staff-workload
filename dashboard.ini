<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Workload Dashboard</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- PapaParse for CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .tab-btn { padding: 0.75rem 1.5rem; font-weight: 600; border-bottom: 2px solid transparent; color: #6b7280; transition: all 0.2s; }
        .tab-btn.active { color: #2563eb; border-bottom-color: #2563eb; background-color: #eff6ff; border-radius: 8px 8px 0 0; }
        .chart-container { position: relative; height: 800px; width: 100%; }
        
        /* Table Styling */
        .data-table th { background-color: #f8fafc; color: #1e293b; font-weight: 600; border: 1px solid #e2e8f0; white-space: nowrap; }
        .data-table td { border: 1px solid #e2e8f0; vertical-align: middle; }
        
        /* Badges */
        .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin: 1px; }
        .badge-phd { background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; }
        .badge-ma { background-color: #fce7f3; color: #9d174d; border: 1px solid #fbcfe8; }
        .badge-ma-ed { background-color: #6b7280; color: #ffffff; border: 1px solid #4b5563; }
        
        /* Loader */
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-4 md:p-6">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-6 flex flex-col md:flex-row justify-between items-center bg-white p-6 rounded-xl shadow-sm">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">üìä Academic Performance Dashboard</h1>
                <p class="text-gray-500 mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏ô‡∏¥‡∏û‡∏ô‡∏ò‡πå ‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</p>
            </div>
            <div class="mt-4 md:mt-0 text-right flex flex-col items-end">
                <div id="loading-indicator" class="text-blue-600 font-semibold mb-2">
                    <div class="loader mr-2"></div> Connecting to GitHub...
                </div>
                <div id="data-status" class="hidden flex flex-col items-end">
                    <div class="flex items-center gap-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span> GitHub Connected
                        </span>
                        <button onclick="init()" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded transition" title="Refresh Data Now">
                            ‚Üª Refresh
                        </button>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">
                        Auto-update in: <span id="countdown-timer" class="font-mono font-bold text-blue-500">300</span>s
                    </p>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="flex border-b border-gray-200 mb-6 overflow-x-auto">
            <button onclick="switchTab('teaching')" id="tab-teaching" class="tab-btn active">‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô (Teaching)</button>
            <button onclick="switchTab('thesis')" id="tab-thesis" class="tab-btn">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏ô‡∏¥‡∏û‡∏ô‡∏ò‡πå (Thesis)</button>
            <button onclick="switchTab('research')" id="tab-research" class="tab-btn">‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ï‡∏µ‡∏û‡∏¥‡∏°‡∏û‡πå (Publication)</button>
            <button onclick="switchTab('summary')" id="tab-summary" class="tab-btn">‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Summary)</button>
        </div>

        <!-- ==================== TAB 1: TEACHING ==================== -->
        <div id="view-teaching" class="view-section space-y-6">
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="card border-l-4 border-blue-500">
                    <h3 class="text-gray-500 text-sm">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏™‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <p id="sum-hours" class="text-3xl font-bold text-gray-800 mt-2">...</p>
                    <span class="text-xs text-gray-400">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</span>
                </div>
                <div class="card border-l-4 border-indigo-500">
                    <h3 class="text-gray-500 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</h3>
                    <p id="sum-instructors" class="text-3xl font-bold text-gray-800 mt-2">...</p>
                    <span class="text-xs text-gray-400">‡∏ó‡πà‡∏≤‡∏ô (‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
                </div>
                <div class="card border-l-4 border-cyan-500">
                    <h3 class="text-gray-500 text-sm">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏≠‡∏ô‡∏£‡∏ß‡∏°</h3>
                    <p id="sum-courses" class="text-3xl font-bold text-gray-800 mt-2">...</p>
                    <span class="text-xs text-gray-400">‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ (‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö)</span>
                </div>
            </div>

            <!-- Teaching Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="text-lg font-bold text-gray-700 mb-4">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Teaching Hours)</h3>
                    <div class="chart-container">
                        <canvas id="chartTeachingHours"></canvas>
                    </div>
                    <div class="mt-2 text-right text-xs text-gray-400">Source: GitHub/teaching_hours.csv</div>
                </div>
                <div class="card">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</h3>
                    <div class="chart-container">
                        <canvas id="chartTeachingCourses"></canvas>
                    </div>
                    <div class="mt-2 text-right text-xs text-gray-400">Source: GitHub/teaching_courses.csv</div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 2: THESIS ==================== -->
        <div id="view-thesis" class="view-section hidden space-y-6">
            <!-- Thesis Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card col-span-2 lg:col-span-1">
                    <h3 class="text-lg font-bold text-gray-700 mb-4">‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ (Advisor Workload)</h3>
                    <div class="chart-container">
                        <canvas id="chartThesisWorkload"></canvas>
                    </div>
                    <div class="mt-2 text-right text-xs text-gray-400">Source: GitHub/thesis_workload.csv</div>
                    <div class="mt-4 flex justify-center gap-4 text-sm text-gray-500">
                        <div class="flex items-center"><span class="w-3 h-3 bg-purple-500 rounded-full mr-2"></span>Main Advisor</div>
                        <div class="flex items-center"><span class="w-3 h-3 bg-pink-400 rounded-full mr-2"></span>Co-Advisor</div>
                    </div>
                </div>
                 <div class="card col-span-2 lg:col-span-1">
                    <h3 class="text-lg font-bold text-gray-700 mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏µ (Overview)</h3>
                    <div class="chart-container">
                        <canvas id="chartThesisProgress"></canvas>
                    </div>
                    <div class="mt-2 text-right text-xs text-gray-400">Source: GitHub/thesis_progress.csv</div>
                </div>
            </div>

            <!-- Detailed Progress Table (Matrix) -->
            <div class="card overflow-hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏£‡∏∏‡πà‡∏ô‡∏õ‡∏µ (Details)</h3>
                    <span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded">Rows: ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | Columns: Stage</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left data-table border-collapse">
                        <thead class="bg-slate-50 text-slate-700" id="thesis-table-head">
                            <!-- JS Generated Headers -->
                        </thead>
                        <tbody id="thesis-table-body" class="bg-white">
                            <!-- JS Generated Rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 3: RESEARCH ==================== -->
        <div id="view-research" class="view-section hidden space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card col-span-1 md:col-span-2">
                    <h3 class="text-lg font-bold text-gray-700 mb-4">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏µ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ (Publications Trend)</h3>
                    <div class="h-[400px] w-full relative">
                        <canvas id="chartPublication"></canvas>
                    </div>
                    <div class="mt-2 text-right text-xs text-gray-400">Source: GitHub/publication.csv</div>
                </div>
            </div>
            
            <div class="card">
                <h3 class="text-lg font-bold text-gray-700 mb-2">‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏µ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</h3>
                <div id="pub-stats" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 mt-4">
                    <!-- JS Generated Stats -->
                </div>
            </div>
        </div>

        <!-- ==================== TAB 4: SUMMARY TABLE ==================== -->
        <div id="view-summary" class="view-section hidden space-y-6">
            <div class="card overflow-hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-700">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Individual Workload Summary)</h3>
                    <button onclick="exportTableToCSV('summary-table')" class="text-sm bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow transition flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Download CSV (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table id="summary-table" class="w-full text-sm text-left data-table border-collapse">
                        <thead class="bg-slate-100 text-slate-700 uppercase" id="summary-table-head">
                            <tr>
                                <th class="px-4 py-3 border w-1/4">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</th>
                                <th class="px-4 py-3 border text-center bg-blue-50 text-blue-900">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏™‡∏≠‡∏ô‡∏£‡∏ß‡∏°</th>
                                <th class="px-4 py-3 border text-center bg-red-50 text-red-900">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</th>
                                <th class="px-4 py-3 border text-center bg-green-50 text-green-900">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô</th>
                                <th class="px-4 py-3 border text-center bg-purple-50 text-purple-900">Main Advisor</th>
                                <th class="px-4 py-3 border text-center bg-pink-50 text-pink-900">Co-Advisor</th>
                                <!-- Dynamic publication columns will be added here -->
                            </tr>
                        </thead>
                        <tbody id="summary-table-body" class="bg-white">
                            <!-- JS Generated -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ================= CONFIGURATION =================
        const TEACHING_HOURS_URL = "https://raw.githubusercontent.com/Supachan/academic-staff-workload/refs/heads/main/teaching_hours.csv";
        const TEACHING_COURSES_URL = "https://raw.githubusercontent.com/Supachan/academic-staff-workload/refs/heads/main/teaching_courses.csv";
        const THESIS_WORKLOAD_URL = "https://raw.githubusercontent.com/Supachan/academic-staff-workload/refs/heads/main/thesis_workload.csv";
        const PUBLICATION_URL = "https://raw.githubusercontent.com/Supachan/academic-staff-workload/refs/heads/main/publication.csv";
        const THESIS_PROGRESS_URL = "https://raw.githubusercontent.com/Supachan/academic-staff-workload/refs/heads/main/thesis_progress.csv";
        const PUBLICATION_CLASSIFIED_URL = "https://raw.githubusercontent.com/Supachan/academic-staff-workload/refs/heads/main/publication_classified.csv";
        
        const REFRESH_INTERVAL_SECONDS = 300; // Auto-refresh every 5 minutes (300s)

        // ================= EMBEDDED DATA (Fallback) =================
        const raw_thesis_progress = `‡∏õ‡∏µ,‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏£‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß,‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏≠ IRB,‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•,‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•,‡∏™‡∏≠‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏ô‡∏¥‡∏û‡∏ô‡∏ò‡πå‡πÅ‡∏•‡πâ‡∏ß,‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏ô‡∏¥‡∏û‡∏ô‡∏ò‡πå
63,-,PhD[QL]x3,MA[Ed]x2,-,-,-
64,-,PhD[QL]x1,PhD[QL]x1,-,-,-
58,-,-,-,-,-,PhD[QL]x4
60,-,-,-,-,-,PhD[QL]x1
61,-,MA[Ed]x1,-,-,-,PhD[QL]x2
65,-,MA[Ed]x3,-,MA[QL]x2,MA[QL]x1,-
62,-,-,-,-,-,-
66,MA[QL]x1,PhD[QL]x2,MA[Ed]x1,-,-,-`;

        const raw_publication = `id,‡∏õ‡∏µ,Q1,Q2,Q3,Q4,TCI1,TCI2,‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Journal),‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Conference)
0,2564 (2021),0,0,0,0,1,0,0,0
1,2565 (2022),0,0,0,0,0,1,0,0
2,2566 (2023),0,0,0,0,3,0,0,0
3,2567 (2024),0,0,0,0,1,0,0,0
4,2568 (2025),0,1,3,1,0,0,1,0`;

        // ================= LOGIC =================
        const ORDERED_NAMES = [
            '‡∏ô‡∏û.‡∏™‡∏°‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥ ‡∏•‡∏µ‡∏•‡∏∞‡∏®‡∏¥‡∏ò‡∏£',
            '‡∏û‡∏ç.‡∏ß‡∏±‡∏ä‡∏£‡∏≤ ‡∏£‡∏¥‡πâ‡∏ß‡πÑ‡∏û‡∏ö‡∏π‡∏•‡∏¢‡πå',
            '‡∏®.‡∏î‡∏£.‡∏ó‡∏ß‡∏µ  ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏ó‡∏ß‡∏µ',
            '‡∏£‡∏®.‡∏î‡∏£.‡∏≠‡∏≤‡∏î‡∏±‡∏° ‡∏ô‡∏µ‡∏•‡∏∞‡πÑ‡∏û‡∏à‡∏¥‡∏ï‡∏£',
            '‡∏£‡∏®.‡∏î‡∏£.‡∏ì‡∏±‡∏è‡∏ê‡∏ô‡∏µ‡∏¢‡∏≤ ‡πÇ‡∏ï‡∏£‡∏±‡∏Å‡∏©‡∏≤',
            '‡∏ú‡∏®.‡∏î‡∏£.‡∏≠‡∏≤‡∏£‡∏µ ‡∏†‡∏≤‡∏ß‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πÑ‡∏û‡∏®‡∏¥‡∏ê',
            '‡∏ú‡∏®.‡∏î‡∏£.‡∏ò‡∏µ‡∏£‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏®‡∏£‡∏µ‡∏™‡∏∏‡∏£‡∏Å‡∏∏‡∏•',
            '‡∏ú‡∏®.‡∏î‡∏£.‡πÄ‡∏à‡∏ô‡∏à‡∏¥‡∏£‡∏≤ ‡πÄ‡∏à‡∏ô‡∏à‡∏¥‡∏ï‡∏£‡∏ß‡∏≤‡∏ì‡∏¥‡∏ä',
            '‡∏î‡∏£.‡∏£‡∏ï‡∏¥‡∏£‡∏™ ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏™‡∏°‡∏î‡∏µ',
            '‡∏î‡∏£.‡∏≠‡∏¥‡∏®‡∏ß‡∏£‡∏≤ ‡∏®‡∏¥‡∏£‡∏¥‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á',
            '‡∏î‡∏£.‡∏ò‡∏£‡∏£‡∏° ‡∏à‡∏ï‡∏∏‡∏ô‡∏≤‡∏°',
            '‡∏î‡∏£.‡∏£‡∏∏‡∏à‡∏¥‡∏£‡∏≤ ‡∏™‡∏á‡∏Ç‡∏≤‡∏ß',
            '‡∏î‡∏£.‡∏õ‡∏£‡πÄ‡∏°‡∏®‡∏ß‡∏£‡πå ‡∏ö‡∏∏‡∏ç‡∏¢‡∏∑‡∏ô',
            '‡∏î‡∏£.‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡πå ‡∏°‡πà‡∏ß‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå',
            '‡∏î‡∏£.‡∏™‡∏∏‡∏ô‡∏±‡∏ô‡∏ó‡∏≤ ‡∏Ç‡∏•‡∏¥‡∏ö‡∏ó‡∏≠‡∏á',
            '‡∏î‡∏£.‡∏ß‡∏£‡∏≤‡∏á‡∏Ñ‡∏ì‡∏≤ ‡∏£‡∏±‡∏ä‡∏ï‡∏∞‡∏ß‡∏£‡∏£‡∏ì',
            '‡∏î‡∏£.‡∏ç‡∏≤‡∏ì‡∏¥‡∏®‡∏≤ ‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡∏ô‡∏≤‡∏ó‡∏ï‡∏£‡∏∞‡∏Å‡∏π‡∏•',
            '‡∏î‡∏£.‡∏™‡∏∏‡∏†‡∏ä‡∏≤‡∏ç ‡∏ï‡∏£‡∏±‡∏¢‡∏ï‡∏£‡∏∂‡∏á‡∏®‡πå‡∏™‡∏Å‡∏∏‡∏•',
            '‡∏î‡∏£.‡∏ß‡∏¥‡∏©‡∏ì‡∏∏ ‡∏ô‡∏¥‡∏ï‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏Å‡∏∏‡∏•',
            '‡∏û‡∏§‡∏´‡∏±‡∏™ ‡∏®‡∏∏‡∏†‡∏à‡∏£‡∏£‡∏¢‡∏≤',
            '‡∏£‡∏≤‡∏©‡∏è‡∏£‡πå ‡∏ö‡∏∏‡∏ç‡∏ç‡∏≤',
            '‡∏Å‡∏∏‡∏•‡∏¢‡∏≤ ‡πÑ‡∏ó‡∏£‡∏á‡∏≤‡∏°',
            '‡∏ì‡∏±‡∏ê‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏®‡∏∏‡∏†‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå',
            '‡∏û‡∏ä‡∏£ ‡∏ô‡∏¥‡∏•‡∏°‡∏ì‡∏µ',
            '‡∏™‡∏¥‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡∏≤ ‡∏§‡∏ó‡∏ò‡∏¥‡πÄ‡∏î‡∏ä',
            '‡∏™‡∏£‡πâ‡∏≠‡∏¢‡∏ó‡∏≠‡∏á ‡∏´‡∏¢‡∏Å‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏±‡∏ô‡∏ï‡πå',
            '‡∏†‡∏±‡∏ó‡∏£‡∏≤‡∏ô‡∏¥‡∏©‡∏ê ‡∏™‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤',
            '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏°.‡∏°‡∏´‡∏¥‡∏î‡∏•)',
            '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Ø‡∏£‡∏≤‡∏°‡∏≤ ‡∏°.‡∏°‡∏´‡∏¥‡∏î‡∏•)'
        ];

        let charts = {};
        let refreshTimer = null;
        let countdownValue = REFRESH_INTERVAL_SECONDS;

        function init() {
            // Show Loading State
            document.getElementById('loading-indicator').classList.remove('hidden');
            document.getElementById('data-status').classList.add('hidden');
            
            // Helper function to fetch CSV
            const fetchCSV = (url) => {
                return new Promise((resolve, reject) => {
                    Papa.parse(url, {
                        download: true,
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => resolve(results.data),
                        error: (err) => reject(err)
                    });
                });
            };

            // Fetch All Data (6 Files)
            Promise.all([
                fetchCSV(TEACHING_HOURS_URL),
                fetchCSV(TEACHING_COURSES_URL),
                fetchCSV(THESIS_WORKLOAD_URL),
                fetchCSV(PUBLICATION_URL),
                fetchCSV(THESIS_PROGRESS_URL),
                fetchCSV(PUBLICATION_CLASSIFIED_URL)
            ]).then(([teachingHours, teachingCourses, thesisWorkload, publication, thesisProgress, pubClassified]) => {
                console.log("GitHub Data Updated at " + new Date().toLocaleTimeString());

                // Render Tabs using FETCHED data
                renderSummaryTab(teachingHours, teachingCourses, thesisWorkload, pubClassified);
                renderTeachingTab(teachingHours, teachingCourses);
                renderThesisTab(thesisWorkload, thesisProgress);
                renderResearchTab(publication);

                // Update UI Status
                document.getElementById('loading-indicator').classList.add('hidden');
                document.getElementById('data-status').classList.remove('hidden');
                
                // Reset Timer
                resetTimer();

            }).catch(err => {
                console.error("Error loading GitHub data:", err);
                document.getElementById('loading-indicator').innerHTML = `<span class="text-red-500">Error loading data. Check console.</span>`;
            });
        }
        
        function resetTimer() {
            if(refreshTimer) clearInterval(refreshTimer);
            countdownValue = REFRESH_INTERVAL_SECONDS;
            updateTimerDisplay();
            
            refreshTimer = setInterval(() => {
                countdownValue--;
                updateTimerDisplay();
                if(countdownValue <= 0) {
                    init(); // Trigger Refresh
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const timerEl = document.getElementById('countdown-timer');
            if(timerEl) timerEl.innerText = countdownValue;
        }

        // --- TAB 0: SUMMARY ---
        function renderSummaryTab(hoursData, coursesData, workloadData, pubClassifiedData) {
            const hoursMap = {};
            hoursData.forEach(item => { if(item.name) hoursMap[item.name.trim()] = parseFloat(item.hr || 0); });

            const coursesMap = {};
            coursesData.forEach(item => {
                if(item.name) {
                    coursesMap[item.name.trim()] = {
                        resp: Math.abs(parseFloat(item['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö'] || 0)),
                        taught: parseFloat(item['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô'] || 0)
                    };
                }
            });

            const thesisMap = {};
            workloadData.forEach(item => {
                const name = item.name || item[Object.keys(item)[0]];
                if(name) {
                    thesisMap[name.trim()] = {
                        main: parseInt(item['Main Advisor'] || 0),
                        co: parseInt(item['Co advisor'] || 0)
                    };
                }
            });

            // Process Publication Classified Data
            const pubClassifiedMap = {};
            let pubHeaders = [];
            
            if (pubClassifiedData && pubClassifiedData.length > 0) {
                // Get dynamic headers from first row
                const firstRow = pubClassifiedData[0];
                pubHeaders = Object.keys(firstRow).filter(k => 
                    k && k.trim() !== '' && // Not empty
                    !k.toLowerCase().includes('unnamed') && // Remove "Unnamed" columns
                    !k.includes('name') && 
                    !k.includes('‡∏•‡∏≥‡∏î‡∏±‡∏ö') && 
                    !k.includes('‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå') && 
                    !k.includes('id')
                );

                pubClassifiedData.forEach(item => {
                    // Try to find the name key
                    const nameKey = Object.keys(item).find(k => k.includes('name') || k.includes('‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå'));
                    if (nameKey && item[nameKey]) {
                        pubClassifiedMap[item[nameKey].trim()] = item;
                    }
                });
            }

            // --- Rebuild Table Header ---
            const thead = document.getElementById('summary-table-head');
            let headerHTML = `
                <tr>
                    <th class="px-4 py-3 border w-1/4">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</th>
                    <th class="px-4 py-3 border text-center bg-blue-50 text-blue-900">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏™‡∏≠‡∏ô‡∏£‡∏ß‡∏°</th>
                    <th class="px-4 py-3 border text-center bg-red-50 text-red-900">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</th>
                    <th class="px-4 py-3 border text-center bg-green-50 text-green-900">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô</th>
                    <th class="px-4 py-3 border text-center bg-purple-50 text-purple-900">Main Advisor</th>
                    <th class="px-4 py-3 border text-center bg-pink-50 text-pink-900">Co-Advisor</th>
            `;
            
            // Add dynamic publication headers
            pubHeaders.forEach(h => {
                headerHTML += `<th class="px-4 py-3 border text-center bg-yellow-50 text-yellow-900">${h}</th>`;
            });
            
            headerHTML += `</tr>`;
            thead.innerHTML = headerHTML;

            // --- Rebuild Table Body ---
            const tbody = document.getElementById('summary-table-body');
            tbody.innerHTML = '';

            ORDERED_NAMES.forEach(name => {
                const cleanName = name.trim();
                const hr = hoursMap[cleanName] || 0;
                const c = coursesMap[cleanName] || { resp: 0, taught: 0 };
                const t = thesisMap[cleanName] || { main: 0, co: 0 };
                const p = pubClassifiedMap[cleanName] || {};

                let rowHTML = `
                    <td class="px-4 py-3 border font-medium text-slate-800">${cleanName}</td>
                    <td class="px-4 py-3 border text-center font-bold text-blue-600">${hr.toFixed(2)}</td>
                    <td class="px-4 py-3 border text-center font-semibold text-red-600">${c.resp}</td>
                    <td class="px-4 py-3 border text-center font-semibold text-green-600">${c.taught}</td>
                    <td class="px-4 py-3 border text-center font-semibold text-purple-600">${t.main}</td>
                    <td class="px-4 py-3 border text-center font-semibold text-pink-500">${t.co}</td>
                `;

                // Add dynamic publication cells
                pubHeaders.forEach(h => {
                    const val = p[h] || 0; // Default to 0 if not found
                    rowHTML += `<td class="px-4 py-3 border text-center text-slate-600">${val}</td>`;
                });

                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition border-b border-slate-100 last:border-0";
                tr.innerHTML = rowHTML;
                tbody.appendChild(tr);
            });
        }

        // --- TAB 1: TEACHING ---
        function renderTeachingTab(hoursData, coursesData) {
            // Index Data for fast lookup
            const hoursMap = {};
            hoursData.forEach(item => {
                if(item.name) hoursMap[item.name.trim()] = parseFloat(item.hr || 0);
            });

            const coursesMap = {};
            coursesData.forEach(item => {
                if(item.name) {
                    coursesMap[item.name.trim()] = {
                        responsible: Math.abs(parseFloat(item['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö'] || 0)),
                        taught: parseFloat(item['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô'] || 0)
                    };
                }
            });

            // Merge based on ORDERED_NAMES
            const merged = ORDERED_NAMES.map(name => {
                const cleanName = name.trim();
                const hr = hoursMap[cleanName] || 0;
                const c = coursesMap[cleanName] || { responsible: 0, taught: 0 };
                
                return {
                    name: cleanName,
                    hr: hr,
                    responsible: c.responsible,
                    taught: c.taught
                };
            });

            // Update Stats
            const totalHours = merged.reduce((sum, i) => sum + i.hr, 0);
            const totalCourses = merged.reduce((sum, i) => sum + i.responsible, 0);
            
            document.getElementById('sum-hours').innerText = totalHours.toFixed(1);
            document.getElementById('sum-instructors').innerText = merged.length;
            document.getElementById('sum-courses').innerText = totalCourses;

            // Chart 1: Hours
            createChart('chartTeachingHours', 'bar', {
                labels: merged.map(i => i.name),
                datasets: [{
                    label: '‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏™‡∏≠‡∏ô',
                    data: merged.map(i => i.hr),
                    backgroundColor: 'rgba(59, 130, 246, 0.8)',
                    borderRadius: 4
                }]
            }, { indexAxis: 'y' });

            // Chart 2: Courses (Split Left/Right)
            createChart('chartTeachingCourses', 'bar', {
                labels: merged.map(i => i.name),
                datasets: [
                    {
                        label: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö (‡∏ã‡πâ‡∏≤‡∏¢)',
                        data: merged.map(i => i.responsible * -1),
                        backgroundColor: 'rgba(239, 68, 68, 0.7)',
                        stack: 'Stack 0'
                    },
                    {
                        label: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô (‡∏Ç‡∏ß‡∏≤)',
                        data: merged.map(i => i.taught),
                        backgroundColor: 'rgba(16, 185, 129, 0.7)',
                        stack: 'Stack 0'
                    }
                ]
            }, { 
                indexAxis: 'y',
                scales: {
                    x: {
                        stacked: true,
                        ticks: {
                            callback: function(value) {
                                return Math.abs(value);
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        position: 'left'
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) { label += ': '; }
                                label += Math.abs(context.raw);
                                return label;
                            }
                        }
                    }
                }
            });
        }

        // --- TAB 2: THESIS ---
        function renderThesisTab(workloadData, progressData) {
            // --- Part 1: Advisor Workload (Sorted by Custom List) ---
            const workloadMap = {};
            workloadData.forEach(item => {
                const name = item.name || item[Object.keys(item)[0]]; 
                if(name) {
                    workloadMap[name.trim()] = {
                        main: parseInt(item['Main Advisor'] || 0),
                        co: parseInt(item['Co advisor'] || 0)
                    };
                }
            });

            const sortedWorkload = ORDERED_NAMES.map(name => {
                const cleanName = name.trim();
                const data = workloadMap[cleanName] || { main: 0, co: 0 };
                return { name: cleanName, ...data };
            });

            createChart('chartThesisWorkload', 'bar', {
                labels: sortedWorkload.map(i => i.name),
                datasets: [
                    {
                        label: 'Main Advisor',
                        data: sortedWorkload.map(i => i.main),
                        backgroundColor: '#a855f7'
                    },
                    {
                        label: 'Co-Advisor',
                        data: sortedWorkload.map(i => i.co),
                        backgroundColor: '#f472b6'
                    }
                ]
            }, {
                indexAxis: 'y',
                scales: { x: { stacked: true }, y: { stacked: true } }
            });

            // --- Part 2: Progress Table ---
            
            // Logic to find "Year" key (Robust for CSV with/without specific header)
            const firstRow = progressData[0];
            let yearKey = '‡∏õ‡∏µ';
            if (!(yearKey in firstRow)) {
                yearKey = Object.keys(firstRow)[0]; // Fallback to first column
            }

            const stages = Object.keys(firstRow).filter(k => k !== yearKey && k !== '');
            const sortedProgress = progressData.sort((a, b) => parseInt(a[yearKey]) - parseInt(b[yearKey]));

            // Header
            const thead = document.getElementById('thesis-table-head');
            let headerHTML = '<tr><th class="p-3 text-center w-24">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>';
            stages.forEach(stage => {
                headerHTML += `<th class="p-3 text-center">${stage}</th>`;
            });
            headerHTML += '</tr>';
            thead.innerHTML = headerHTML;

            // Body
            const tbody = document.getElementById('thesis-table-body');
            tbody.innerHTML = '';

            sortedProgress.forEach(row => {
                if(!row[yearKey]) return;
                
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition-colors";
                
                let rowContent = `<td class="p-3 text-center font-bold text-slate-700 bg-slate-50 border-r border-slate-200">${row[yearKey]}</td>`;
                
                stages.forEach(stage => {
                    const content = row[stage];
                    let cellContent = '-';
                    
                    if (content && content !== '-' && content.trim() !== '') {
                        const parts = content.split(' ').join('').match(/([a-zA-Z\[\]]+)x(\d+)/g);
                        
                        if (parts) {
                            cellContent = parts.map(part => {
                                const [_, type, count] = part.match(/([a-zA-Z\[\]]+)x(\d+)/);
                                
                                // Determine class based on type
                                let badgeClass = 'badge-ma';
                                if (type.toLowerCase().includes('ed')) {
                                    badgeClass = 'badge-ma-ed';
                                } else if (type.toLowerCase().includes('phd')) {
                                    badgeClass = 'badge-phd';
                                }
                                
                                return `<span class="badge ${badgeClass}">${type}: ${count}</span>`;
                            }).join(' ');
                        } else {
                            cellContent = `<span class="text-xs text-gray-600">${content}</span>`;
                        }
                    } else {
                         cellContent = '<span class="text-gray-200">-</span>';
                    }
                    
                    rowContent += `<td class="p-3 text-center">${cellContent}</td>`;
                });
                
                tr.innerHTML = rowContent;
                tbody.appendChild(tr);
            });

            // --- Part 3: Progress Chart ---
            const progressDatasets = stages.map((stage, idx) => {
                const colors = ['#fca5a5', '#fdba74', '#fde047', '#86efac', '#93c5fd', '#c4b5fd'];
                return {
                    label: stage,
                    data: sortedProgress.map(row => {
                        const cell = row[stage] || '';
                        if (cell === '-' || !cell) return 0;
                        const matches = cell.match(/x(\d+)/g);
                        if (matches) {
                            return matches.reduce((sum, val) => sum + parseInt(val.replace('x', '')), 0);
                        }
                        return 0;
                    }),
                    backgroundColor: colors[idx % colors.length]
                };
            });

            createChart('chartThesisProgress', 'bar', {
                labels: sortedProgress.map(r => '‡∏õ‡∏µ ' + r[yearKey]),
                datasets: progressDatasets
            }, {
                scales: { x: { stacked: true }, y: { stacked: true } }
            });
        }

        // --- TAB 3: RESEARCH ---
        function renderResearchTab(pubData) {
            // Update categories to include all demanded types
            const categories = ['Q1', 'Q2', 'Q3', 'Q4', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Journal)', 'TCI1', 'TCI2', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Conference)'];
            const years = pubData.map(r => r['‡∏õ‡∏µ']);

            // Custom colors
            const categoryColors = {
                'Q1': '#16a34a', // Green
                'Q2': '#dbeafe', // Light Blue
                'Q3': '#f59e0b', // Amber
                'Q4': '#ef4444', // Red
                '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Journal)': '#6b7280', // Gray (reused from old others)
                'TCI1': '#f3e8ff', // Light Purple
                'TCI2': '#fef9c3', // Light Yellow
                '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Conference)': '#374151' // Darker Gray
            };

            const datasets = categories.map((cat, idx) => {
                return {
                    label: cat,
                    data: pubData.map(r => parseInt(r[cat] || 0)),
                    backgroundColor: categoryColors[cat] || '#cccccc', // Default gray if not found
                };
            });

            const statsContainer = document.getElementById('pub-stats');
            statsContainer.innerHTML = ''; // Clear existing
            
            categories.forEach((cat, idx) => {
                const total = pubData.reduce((sum, r) => sum + parseInt(r[cat] || 0), 0);
                
                // Styles for stats cards
                let cardStyle = `background-color: ${categoryColors[cat] || '#f3f4f6'}; color: #1f2937;`;
                // Dark background text fix
                if(['Q1', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Journal)', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Conference)'].includes(cat)) {
                    cardStyle = `background-color: ${categoryColors[cat]}; color: white;`; 
                }
                
                const div = document.createElement('div');
                div.className = `p-3 rounded-lg text-center shadow-sm`;
                div.style = cardStyle;
                div.innerHTML = `<div class="text-[10px] font-bold uppercase truncate" title="${cat}">${cat}</div><div class="text-2xl font-bold mt-1">${total}</div>`;
                statsContainer.appendChild(div);
            });

            createChart('chartPublication', 'bar', {
                labels: years,
                datasets: datasets
            }, {
                scales: { x: { stacked: true }, y: { stacked: true } }
            });
        }

        // --- UTILS ---
        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + tabId).classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        function createChart(canvasId, type, data, extraOptions = {}) {
            if (charts[canvasId]) charts[canvasId].destroy();
            const ctx = document.getElementById(canvasId).getContext('2d');
            charts[canvasId] = new Chart(ctx, {
                type: type,
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    ...extraOptions
                }
            });
        }
        
        function exportTableToCSV(tableId) {
            const table = document.getElementById(tableId);
            let rows = [];
            
            // Get headers
            let headers = [];
            for (let i = 0; i < table.rows[0].cells.length; i++) {
                let text = table.rows[0].cells[i].innerText;
                if (text.includes(',') || text.includes('"')) {
                    text = '"' + text.replace(/"/g, '""') + '"';
                }
                headers.push(text);
            }
            rows.push(headers.join(","));
            
            // Get data
            for (let i = 1; i < table.rows.length; i++) {
                let row = [];
                for (let j = 0; j < table.rows[i].cells.length; j++) {
                    let text = table.rows[i].cells[j].innerText;
                    if (text.includes(',') || text.includes('"')) {
                        text = '"' + text.replace(/"/g, '""') + '"';
                    }
                    row.push(text);
                }
                rows.push(row.join(","));
            }
            
            const csvContent = "\uFEFF" + rows.join("\n");
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", "academic_workload_summary.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        window.onload = init;
    </script>
</body>
</html>